"use strict";(self.webpackChunkambari_website=self.webpackChunkambari_website||[]).push([[2321],{24173:(e,r,s)=>{s.d(r,{A:()=>i});const i=s.p+"assets/images/connect-phoenix-9e9ee4da01440af51806ce2aa4372809.png"},28453:(e,r,s)=>{s.d(r,{R:()=>d,x:()=>c});var i=s(96540);const n={},t=i.createContext(n);function d(e){const r=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),i.createElement(t.Provider,{value:r},e.children)}},92937:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"ambari-design/metrics/operations","title":"Operations","description":"Metrics Collector","source":"@site/docs/ambari-design/metrics/operations.md","sourceDirName":"ambari-design/metrics","slug":"/ambari-design/metrics/operations","permalink":"/docs/next/ambari-design/metrics/operations","draft":false,"unlisted":false,"editUrl":"https://github.com/vivostar/vivostar.github.io/tree/master/docs/ambari-design/metrics/operations.md","tags":[],"version":"current","frontMatter":{},"sidebar":"ambariSidebar","previous":{"title":"Configuration","permalink":"/docs/next/ambari-design/metrics/configuration"},"next":{"title":"Troubleshooting","permalink":"/docs/next/ambari-design/metrics/troubleshooting"}}');var n=s(74848),t=s(28453);const d={},c="Operations",l={},a=[{value:"Metrics Collector",id:"metrics-collector",level:2},{value:"Metrics Monitor",id:"metrics-monitor",level:2},{value:"Build Instructions",id:"build-instructions",level:2},{value:"RPM packages",id:"rpm-packages",level:3},{value:"Debian packages",id:"debian-packages",level:3},{value:"Windows msi",id:"windows-msi",level:3},{value:"Command line parameters",id:"command-line-parameters",level:3},{value:"Disk space utilization guidance",id:"disk-space-utilization-guidance",level:2},{value:"Phoenix Schema",id:"phoenix-schema",level:2},{value:"Phoenix Tables",id:"phoenix-tables",level:3},{value:"Connecting to Phoenix",id:"connecting-to-phoenix",level:3}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"operations",children:"Operations"})}),"\n",(0,n.jsx)(r.h2,{id:"metrics-collector",children:"Metrics Collector"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Pid file locations"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Daemon"}),(0,n.jsx)(r.th,{children:"Default User"}),(0,n.jsx)(r.th,{children:"Pid File Path"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Metrics Collector API"}),(0,n.jsx)(r.td,{children:"ams"}),(0,n.jsx)(r.td,{children:"/var/run/ambari-metrics-collector/ambari-metrics-collector.pid"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Metrics Collector Hbase"}),(0,n.jsx)(r.td,{children:"ams"}),(0,n.jsx)(r.td,{children:"/var/run/ambari-metrics-collector/hbase-ams-master.pid"})]})]})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Log file locations"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Daemon"}),(0,n.jsx)(r.th,{children:"Log File Path"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Metrics Collector API"}),(0,n.jsxs)(r.td,{children:["/var/log/ambari-metrics-collector/ambari-metrics-collector.log",(0,n.jsx)("br",{}),"/var/log/ambari-metrics-collector/ambari-metrics-collector.out"]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Metrics Collector HBase"}),(0,n.jsxs)(r.td,{children:["/var/log/ambari-metrics-collector/hbase-ams-master-<hostname>.log",(0,n.jsx)("br",{}),"/var/log/ambari-metrics-collector/hbase-ams-master-<hostname>.out"]})]})]})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Manually restart Metrics Collector"})}),"\n",(0,n.jsx)(r.p,{children:"Stop command"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"su - ams -c '/usr/sbin/ambari-metrics-collector --config /etc/ambari-metrics-collector/conf/ stop'\n"})}),"\n",(0,n.jsx)(r.p,{children:"Start command"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"su - ams -c '/usr/sbin/ambari-metrics-collector --config /etc/ambari-metrics-collector/conf/ start'\n"})}),"\n",(0,n.jsx)(r.h2,{id:"metrics-monitor",children:"Metrics Monitor"}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Pid File location"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"/var/run/ambari-metrics-monitor/ambari-metrics-monitor.pid\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Log File location"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"/var/log/ambari-metrics-monitor/ambari-metrics-monitor.out\n"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Manually restart Metrics Monitor"}),"\nStop command"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"su - ams -c '/usr/sbin/ambari-metrics-monitor --config /etc/ambari-metrics-monitor/conf stop'\n"})}),"\n",(0,n.jsx)(r.p,{children:"Start command"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"su - ams -c '/usr/sbin/ambari-metrics-monitor --config /etc/ambari-metrics-monitor/conf start'\n"})}),"\n",(0,n.jsx)(r.h2,{id:"build-instructions",children:"Build Instructions"}),"\n",(0,n.jsx)(r.p,{children:"The ambari-metrics-assembly package builds the assemblies (rpm/deb/msi) for various platforms."}),"\n",(0,n.jsx)(r.p,{children:"Following binaries can be found in the ambari-metrics-assembly/target folder after build is successful."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"ambari-metrics-collecor-<ambari-version>.<arch>\nambari-metrics-monitor-<ambari-version>.<arch>\nambari-hadoop-sink-<ambari-version>.<arch>\n"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Note"}),": Ambari Metrics needs to be built before Ambari Server"]}),"\n",(0,n.jsx)(r.h3,{id:"rpm-packages",children:"RPM packages"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"cd ambari-metrics\nmvn clean package -Dbuild-rpm\n"})}),"\n",(0,n.jsx)(r.h3,{id:"debian-packages",children:"Debian packages"}),"\n",(0,n.jsx)(r.p,{children:"Same instruction as above, change the maven target to build-deb"}),"\n",(0,n.jsx)(r.h3,{id:"windows-msi",children:"Windows msi"}),"\n",(0,n.jsx)(r.p,{children:"TBU"}),"\n",(0,n.jsx)(r.h3,{id:"command-line-parameters",children:"Command line parameters"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Parameter"}),(0,n.jsx)(r.th,{children:"Default Value"}),(0,n.jsx)(r.th,{children:"Comment"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"hbase.tar"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.3.0.0/tars/hbase-1.1.1.2.3.0.0-2557.tar.gz",children:"http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.3.0.0/tars/hbase-1.1.1.2.3.0.0-2557.tar.gz"})}),(0,n.jsx)(r.td,{children:"HBase tarball. This is default version for Ambari 2.1.2"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"hbase.folder"}),(0,n.jsx)(r.td,{children:"hbase-1.1.1.2.3.0.0-2557"}),(0,n.jsx)(r.td,{children:"-"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"hadoop.tar"}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.a,{href:"http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.3.0.0/tars/hadoop-2.7.1.2.3.0.0-2557.tar.gz",children:"http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.3.0.0/tars/hadoop-2.7.1.2.3.0.0-2557.tar.gz"})}),(0,n.jsx)(r.td,{children:"Hadoop tarball, used for native libs. This is default version for Ambari 2.1.2"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"hadoop.folder"}),(0,n.jsx)(r.td,{children:"hadoop-2.7.1.2.3.0.0-2557"}),(0,n.jsx)(r.td,{children:"-"})]})]})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Note"})}),"\n",(0,n.jsxs)(r.p,{children:["After the change introducted by  ",(0,n.jsx)(r.a,{href:"https://issues.apache.org/jira/browse/AMBARI-18915",children:"AMBARI-18915"})," - Update AMS pom to use Apache hbase,hadoop,phoenix tarballs REOPENED AMS uses hadoop tars downloaded from Apache by default. Since that version of libhadoop is not built with libsnappy, the following config change in ams-site is needed to make AMS start up correctly."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"timeline.metrics.hbase.compression.scheme = None"})}),"\n",(0,n.jsx)(r.h2,{id:"disk-space-utilization-guidance",children:"Disk space utilization guidance"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Num of Nodes"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD_MINUTE (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD_HOURLY (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD_DAILY (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE_MINUTE (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE_HOURLY (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE_DAILY (MB)"}),(0,n.jsx)(r.th,{children:"TOTAL (GB)"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"50"}),(0,n.jsx)(r.td,{children:"5120"}),(0,n.jsx)(r.td,{children:"2700"}),(0,n.jsx)(r.td,{children:"245"}),(0,n.jsx)(r.td,{children:"10"}),(0,n.jsx)(r.td,{children:"1500"}),(0,n.jsx)(r.td,{children:"305"}),(0,n.jsx)(r.td,{children:"28"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"10"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"100"}),(0,n.jsx)(r.td,{children:"10240"}),(0,n.jsx)(r.td,{children:"5400"}),(0,n.jsx)(r.td,{children:"490"}),(0,n.jsx)(r.td,{children:"20"}),(0,n.jsx)(r.td,{children:"1500"}),(0,n.jsx)(r.td,{children:"305"}),(0,n.jsx)(r.td,{children:"28"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"18"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"300"}),(0,n.jsx)(r.td,{children:"30720"}),(0,n.jsx)(r.td,{children:"16200"}),(0,n.jsx)(r.td,{children:"1470"}),(0,n.jsx)(r.td,{children:"60"}),(0,n.jsx)(r.td,{children:"1500"}),(0,n.jsx)(r.td,{children:"305"}),(0,n.jsx)(r.td,{children:"28"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"49"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"500"}),(0,n.jsx)(r.td,{children:"51200"}),(0,n.jsx)(r.td,{children:"27000"}),(0,n.jsx)(r.td,{children:"2450"}),(0,n.jsx)(r.td,{children:"100"}),(0,n.jsx)(r.td,{children:"1500"}),(0,n.jsx)(r.td,{children:"305"}),(0,n.jsx)(r.td,{children:"28"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"81"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"800"}),(0,n.jsx)(r.td,{children:"81920"}),(0,n.jsx)(r.td,{children:"43200"}),(0,n.jsx)(r.td,{children:"3920"}),(0,n.jsx)(r.td,{children:"160"}),(0,n.jsx)(r.td,{children:"1500"}),(0,n.jsx)(r.td,{children:"305"}),(0,n.jsx)(r.td,{children:"28"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"128"})]})]})]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"NOTE"}),":"]}),"\n",(0,n.jsx)(r.p,{children:"The above guidance has been derived from looking at AMS disk utilization in actual clusters.\nThe ACTUAL numbers have been obtained by observing an actual cluster with the basic services (HDFS, YARN, HBase) installed along with Storm, Kafka and Flume.\nKafka and Flume generate metrics only while a job is running. If those services are being used heavily, additional disk space is recommended. We ran sample jobs with STORM and KAFKA while deriving these numbers to make sure there is some contribution."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Actual disk utilization data"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Num of Nodes"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD_MINUTE (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD_HOURLY (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_RECORD_DAILY (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE_MINUTE (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE_HOURLY (MB)"}),(0,n.jsx)(r.th,{children:"METRIC_AGGREGATE_DAILY (MB)"}),(0,n.jsx)(r.th,{children:"TOTAL (GB)"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"2"}),(0,n.jsx)(r.td,{children:"120"}),(0,n.jsx)(r.td,{children:"175"}),(0,n.jsx)(r.td,{children:"17"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"545"}),(0,n.jsx)(r.td,{children:"136"}),(0,n.jsx)(r.td,{children:"16"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"1"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"3"}),(0,n.jsx)(r.td,{children:"294"}),(0,n.jsx)(r.td,{children:"51"}),(0,n.jsx)(r.td,{children:"3.4"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"104"}),(0,n.jsx)(r.td,{children:"26"}),(0,n.jsx)(r.td,{children:"1.8"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"0.5"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"10"}),(0,n.jsx)(r.td,{children:"1024"}),(0,n.jsx)(r.td,{children:"540"}),(0,n.jsx)(r.td,{children:"49"}),(0,n.jsx)(r.td,{children:"2"}),(0,n.jsx)(r.td,{children:"1433.6"}),(0,n.jsx)(r.td,{children:"305"}),(0,n.jsx)(r.td,{children:"28"}),(0,n.jsx)(r.td,{children:"1"}),(0,n.jsx)(r.td,{children:"3.3"})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"phoenix-schema",children:"Phoenix Schema"}),"\n",(0,n.jsx)(r.h3,{id:"phoenix-tables",children:"Phoenix Tables"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Table Name"}),(0,n.jsx)(r.th,{children:"Description"}),(0,n.jsx)(r.th,{children:"Purge Interval(default)"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_RECORD"}),(0,n.jsx)(r.td,{children:"Data per metric per host at 10 seconds precision with 1 minute aggregates."}),(0,n.jsx)(r.td,{children:"1 day"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_RECORD_MINUTE"}),(0,n.jsx)(r.td,{children:"Data per metric per host at 5 minute precision"}),(0,n.jsx)(r.td,{children:"1 week"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_RECORD_HOURLY"}),(0,n.jsx)(r.td,{children:"Data per metric per host at 1 hour precision"}),(0,n.jsx)(r.td,{children:"30 days"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_RECORD_DAILY"}),(0,n.jsx)(r.td,{children:"Data per metric per host at 1 day precision"}),(0,n.jsx)(r.td,{children:"1 year"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_AGGREGATE"}),(0,n.jsx)(r.td,{children:"Cluster wide aggregates per metric at 30 seconds precision"}),(0,n.jsx)(r.td,{children:"1 week"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_AGGREGATE_MINUTE"}),(0,n.jsx)(r.td,{children:"Cluster wide aggregates per metric at 5 minute precision"}),(0,n.jsx)(r.td,{children:"30 days"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_AGGREGATE_HOURLY"}),(0,n.jsx)(r.td,{children:"Cluster wide aggregates per metric at 1 hour precision"}),(0,n.jsx)(r.td,{children:"1 year"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"METRIC_AGGREGATE_DAILY"}),(0,n.jsx)(r.td,{children:"Cluster wide aggregates per metric at 1 day precision"}),(0,n.jsx)(r.td,{children:"2 years"})]})]})]}),"\n",(0,n.jsx)(r.h3,{id:"connecting-to-phoenix",children:"Connecting to Phoenix"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Unpack Phoenix (4.2.0+) tarball onto the Metric Collector host"}),"\n",(0,n.jsx)(r.li,{children:"Change director to phonenix-4.*/bin"}),"\n",(0,n.jsx)(r.li,{children:'Edit sqlline.py and search for "java",  replace java with full path to the java executable, example: "/usr/jdk64/jdk1.8.0_40/bin/java"'}),"\n",(0,n.jsx)(r.li,{children:"Connect command:\nAmbari versions 2.2.0 and below : ./sqlline.py localhost:61181:/hbase\nAmbari versions > 2.2.0  :"}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"./sqlline.py localhost:61181:/ams-hbase-unsecure (embedded mode) and <cluster-zookeeper-quorum-host>:<cluster_zookeeper_port>:/ams-hbase-unsecure (distributed mode)\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{src:s(24173).A+"",title:"Connect Phoenix",width:"563",height:"176"})})]})}function o(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}}}]);