"use strict";(self.webpackChunkambari_website=self.webpackChunkambari_website||[]).push([[6575],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,k=m["".concat(l,".").concat(u)]||m[u]||d[u]||a;return n?i.createElement(k,o(o({ref:t},c),{},{components:n})):i.createElement(k,o({ref:t},c))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<a;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2663:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var i=n(7462),r=(n(7294),n(3905));const a={title:"The Kerberos Descriptor"},o=void 0,s={unversionedId:"ambari-design/kerberos/kerberos_descriptor",id:"version-2.7.5/ambari-design/kerberos/kerberos_descriptor",title:"The Kerberos Descriptor",description:"\x3c!---",source:"@site/versioned_docs/version-2.7.5/ambari-design/kerberos/kerberos_descriptor.md",sourceDirName:"ambari-design/kerberos",slug:"/ambari-design/kerberos/kerberos_descriptor",permalink:"/docs/2.7.5/ambari-design/kerberos/kerberos_descriptor",draft:!1,editUrl:"https://github.com/vivostar/vivostar.github.io/tree/master/versioned_docs/version-2.7.5/ambari-design/kerberos/kerberos_descriptor.md",tags:[],version:"2.7.5",frontMatter:{title:"The Kerberos Descriptor"},sidebar:"ambariSidebar",previous:{title:"Ambari Kerberos Automation",permalink:"/docs/2.7.5/kerberos"},next:{title:"The Kerberos Service",permalink:"/docs/2.7.5/ambari-design/kerberos/kerberos_service"}},l={},p=[{value:"The Kerberos Descriptor",id:"the-kerberos-descriptor",level:2},{value:"Components of a Kerberos Descriptor",id:"components-of-a-kerberos-descriptor",level:3},{value:"Stack-level Properties",id:"stack-level-properties",level:4},{value:"Stack-level Identities",id:"stack-level-identities",level:4},{value:"Stack-level Auth-to-local-properties",id:"stack-level-auth-to-local-properties",level:4},{value:"Stack-level Configurations",id:"stack-level-configurations",level:4},{value:"Services",id:"services",level:4},{value:"Service-level Identities",id:"service-level-identities",level:4},{value:"Examples",id:"examples",level:5},{value:"Service-level Auth-to-local-properties",id:"service-level-auth-to-local-properties",level:4},{value:"Service-level Configurations",id:"service-level-configurations",level:4},{value:"Components",id:"components",level:4},{value:"Component-level Identities",id:"component-level-identities",level:4},{value:"Component-level Auth-to-local-properties",id:"component-level-auth-to-local-properties",level:4},{value:"Component-level Configurations",id:"component-level-configurations",level:4},{value:"Descriptor Specifications",id:"descriptor-specifications",level:3},{value:"properties",id:"properties",level:4},{value:"auth-to-local-properties",id:"auth-to-local-properties",level:4},{value:"configurations",id:"configurations",level:4},{value:"identities",id:"identities",level:4},{value:"principal",id:"principal",level:4},{value:"keytab",id:"keytab",level:4},{value:"services",id:"services-1",level:4},{value:"components",id:"components-1",level:4},{value:"Examples",id:"examples-1",level:3},{value:"Example Stack-level Kerberos Descriptor",id:"example-stack-level-kerberos-descriptor",level:4},{value:"Example Service-level Kerberos Descriptor",id:"example-service-level-kerberos-descriptor",level:4}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/2.7.5/kerberos"},"Introduction")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#the-kerberos-descriptor"},"The Kerberos Descriptor"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#components-of-a-kerberos-descriptor"},"Components of a Kerberos Descriptor"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#stack-level-properties"},"Stack-level Properties")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#stack-level-identities"},"Stack-level Identities")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#stack-level-auth-to-local-properties"},"Stack-level Auth-to-local-properties")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#stack-level-configuratons"},"Stack-level Configurations")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#services"},"Services")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#service-level-identities"},"Service-level Identities")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#service-level-auth-to-local-properties"},"Service-level Auth-to-local-properties")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#service-level-configurations"},"Service-level Configurations")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#service-components"},"Components")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#component-level-identities"},"Component-level Identities")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#component-level-auth-to-local-properties"},"Component-level Auth-to-local-properties")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#component-level-configurations"},"Component-level Configurations")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#kerberos-descriptor-specifications"},"Kerberos Descriptor specifications"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#properties"},"properties")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#auth-to-local-properties"},"auth-to-local-properties")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#configurations"},"configurations")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#identities"},"identities")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#principal"},"principal")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#keytab"},"keytab")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#services"},"services")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#components"},"components")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#examples"},"Examples")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/2.7.5/ambari-design/kerberos/kerberos_service"},"The Kerberos Service")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/2.7.5/ambari-design/kerberos/enabling_kerberos"},"Enabling Kerberos"))),(0,r.kt)("a",{name:"the-kerberos-descriptor"}),(0,r.kt)("h2",{id:"the-kerberos-descriptor"},"The Kerberos Descriptor"),(0,r.kt)("p",null,"The Kerberos Descriptor is a JSON-formatted text file containing information needed by Ambari to enable\nor disable Kerberos for a stack and its services. This file must be named ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"kerberos.json"))," and should\nbe in the root directory of the relevant stack or service definition. Kerberos Descriptors are meant to\nbe hierarchical such that details in the stack-level descriptor can be overwritten (or updated) by details\nin the service-level descriptors."),(0,r.kt)("p",null,"For the services in a stack to be Kerberized, there must be a stack-level Kerberos Descriptor. This\nensures that even if a common service has a Kerberos Descriptor, it may not be Kerberized unless the\nrelevant stack indicates that supports Kerberos by having a stack-level Kerberos Descriptor."),(0,r.kt)("p",null,"For a component of a service to be Kerberized, there must be an entry for it in its containing service's\nservice-level descriptor. This allows for some of a services' components to be managed and other\ncomponents of that service to be ignored by the automated Kerberos facility."),(0,r.kt)("p",null,"Kerberos Descriptors are inherited from the base stack or service, but may be overridden as a full\ndescriptor - partial descriptors are not allowed."),(0,r.kt)("p",null,"A complete descriptor (which is built using the stack-level descriptor, the service-level descriptors,\nand any updates from user input) has the following structure:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Stack-level Properties"),(0,r.kt)("li",{parentName:"ul"},"Stack-level Identities"),(0,r.kt)("li",{parentName:"ul"},"Stack-level Configurations"),(0,r.kt)("li",{parentName:"ul"},"Stack-level Auth-to-local-properties"),(0,r.kt)("li",{parentName:"ul"},"Services",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Service-level Identities"),(0,r.kt)("li",{parentName:"ul"},"Service-level Auth-to-local-properties"),(0,r.kt)("li",{parentName:"ul"},"Service-level Configurations"),(0,r.kt)("li",{parentName:"ul"},"Components",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Component-level Identities"),(0,r.kt)("li",{parentName:"ul"},"Component-level Auth-to-local-properties"),(0,r.kt)("li",{parentName:"ul"},"Component-level Configurations")))))),(0,r.kt)("p",null,"Each level of the descriptor inherits the data from its parent. This data, however, may be overridden\nif necessary. For example, a component will inherit the configurations and identities of its container\nservice; which in turn inherits the configurations and identities from the stack."),(0,r.kt)("a",{name:"components-of-a-kerberos-descriptor"}),(0,r.kt)("h3",{id:"components-of-a-kerberos-descriptor"},"Components of a Kerberos Descriptor"),(0,r.kt)("a",{name:"stack-level-properties"}),(0,r.kt)("h4",{id:"stack-level-properties"},"Stack-level Properties"),(0,r.kt)("p",null,'Stack-level properties is an optional set of name/value pairs that can be used in variable replacements.\nFor example, if a property named "',(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"property1")),'" exists with the value of "',(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"value1")),'", then any instance of\n"',(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"${property1}")),'" within a configuration property name or configuration property value will be replaced\nwith "',(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"value1")),'".'),(0,r.kt)("p",null,"This property is only relevant in the stack-level Kerberos Descriptor and may not be overridden by\nlower-level descriptors."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#properties"},"properties"),"."),(0,r.kt)("a",{name:"stack-level-identities"}),(0,r.kt)("h4",{id:"stack-level-identities"},"Stack-level Identities"),(0,r.kt)("p",null,'Stack-level identities is an optional identities block containing a list of zero or more identity\ndescriptors that are common among all services in the stack. An example of such an identity is the\nAmbari smoke test user, which is used by all services to perform service check operations. Service-\nand component-level identities may reference (and specialize) stack-level identities using the\nidentity\u2019s name with a forward slash (/) preceding it. For example if there was a stack-level identity\nwith the name "smokeuser", then a service or a component may create an identity block that references\nand specializes it by declaring a "',(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"reference")),'" property and setting it to "/smokeuser".  Within\nthis identity block details of the identity may be and overwritten as necessary. This does not alter\nthe stack-level identity, it essentially creates a copy of it and updates the copy\'s properties.'),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#identities"},"identities"),"."),(0,r.kt)("a",{name:"stack-level-auth-to-local-properties"}),(0,r.kt)("h4",{id:"stack-level-auth-to-local-properties"},"Stack-level Auth-to-local-properties"),(0,r.kt)("p",null,"Stack-level auth-to-local-properties is an optional list of zero or more configuration property\nspecifications ",(0,r.kt)("inlineCode",{parentName:"p"},"(config-type/property_name[|concatenation_scheme])")," indicating which properties should\nbe updated with dynamically generated auto-to-local rule sets."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#auth-to-local-properties"},"auth-to-local-properties"),"."),(0,r.kt)("a",{name:"stack-level-configurations"}),(0,r.kt)("h4",{id:"stack-level-configurations"},"Stack-level Configurations"),(0,r.kt)("p",null,"Stack-level configurations is an optional configurations block containing a list of zero or more\nconfiguration descriptors that are common among all services in the stack. Configuration descriptors\nare overridable due to the structure of the data.  However, overriding configuration properties may\ncreate undesired behavior since it is not known until after the Kerberization process is complete\nwhat value a property will have."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#configurations"},"configurations"),"."),(0,r.kt)("a",{name:"services"}),(0,r.kt)("h4",{id:"services"},"Services"),(0,r.kt)("p",null,"Services is a list of zero or more service descriptors. A stack-level Kerberos Descriptor should not\nlist any services; however a service-level Kerberos Descriptor should contain at least one."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#services"},"services"),"."),(0,r.kt)("a",{name:"service-level-identities"}),(0,r.kt)("h4",{id:"service-level-identities"},"Service-level Identities"),(0,r.kt)("p",null,"Service-level identities is an optional identities block containing a list of zero or more identity\ndescriptors that are common among all components of the service. Component-level identities may\nreference (and specialize) service-level identities by specifying a relative or an absolute path\nto it."),(0,r.kt)("p",null,'For example if there was a service-level identity with the name "service_identity", then a child\ncomponent may create an identity block that references and specializes it by setting its "reference"\nattribute to "../service_identity" or "/service_name/service_identity" and overriding any values as\nnecessary. This does not override the service-level identity, it essentially creates a copy of it and\nupdates the copy\'s properties.'),(0,r.kt)("h5",{id:"examples"},"Examples"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "name" : "relative_path_example",\n  "reference" : "../service_identity",\n  ...\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "name" : "absolute_path_example",\n  "reference" : "/SERVICE/service_identity",\n  ...\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": By using the absolute path to an identity, any service-level identity may be referenced by\nany other service or component."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#identities"},"identities"),"."),(0,r.kt)("a",{name:"service-level-auth-to-local-properties"}),(0,r.kt)("h4",{id:"service-level-auth-to-local-properties"},"Service-level Auth-to-local-properties"),(0,r.kt)("p",null,"Service-level auth-to-local-properties is an optional list of zero or more configuration property\nspecifications ",(0,r.kt)("inlineCode",{parentName:"p"},"(config-type/property_name[|concatenation_scheme])")," indicating which properties should\nbe updated with dynamically generated auto-to-local rule sets."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#auth-to-local-properties"},"auth-to-local-properties"),"."),(0,r.kt)("a",{name:"service-level-configurations"}),(0,r.kt)("h4",{id:"service-level-configurations"},"Service-level Configurations"),(0,r.kt)("p",null,"Service-level configurations is an optional configurations block listing of zero or more configuration\ndescriptors that are common among all components within a service. Configuration descriptors may be\noverridden due to the structure of the data. However, overriding configuration properties may create\nundesired behavior since it is not known until after the Kerberization process is complete what value\na property will have."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#configurations"},"configurations"),"."),(0,r.kt)("a",{name:"service-components"}),(0,r.kt)("h4",{id:"components"},"Components"),(0,r.kt)("p",null,"Components is a list of zero or more component descriptor blocks."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#components"},"components"),"."),(0,r.kt)("a",{name:"component-level-identities"}),(0,r.kt)("h4",{id:"component-level-identities"},"Component-level Identities"),(0,r.kt)("p",null,"Component-level identities is an optional identities block containing a list of zero or more identity\ndescriptors that are specific to the component. A Component-level identity may be referenced\n(and specialized) by using the absolute path to it (",(0,r.kt)("inlineCode",{parentName:"p"},"/service_name/component_name/identity_name"),").\nThis does not override the component-level identity, it essentially creates a copy of it and updates\nthe copy's properties."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#identities"},"identities"),"."),(0,r.kt)("a",{name:"component-level-auth-to-local-properties"}),(0,r.kt)("h4",{id:"component-level-auth-to-local-properties"},"Component-level Auth-to-local-properties"),(0,r.kt)("p",null,"Component-level auth-to-local-properties is an optional list of zero or more configuration property\nspecifications ",(0,r.kt)("inlineCode",{parentName:"p"},"(config-type/property_name[|concatenation_scheme])")," indicating which properties should\nbe updated with dynamically generated auto-to-local rule sets."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#auth-to-local-properties"},"auth-to-local-properties"),"."),(0,r.kt)("a",{name:"component-level-configurations"}),(0,r.kt)("h4",{id:"component-level-configurations"},"Component-level Configurations"),(0,r.kt)("p",null,"Component-level configurations is an optional configurations block listing zero or more configuration\ndescriptors that are specific to the component."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"#configurations"},"configurations"),"."),(0,r.kt)("h3",{id:"descriptor-specifications"},"Descriptor Specifications"),(0,r.kt)("a",{name:"properties"}),(0,r.kt)("h4",{id:"properties"},"properties"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"properties")," block is only valid in the service-level Kerberos Descriptor file. This block is\na set of name/value pairs as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"properties" : {\n  "property_1" : "value_1",\n  "property_2" : "value_2",\n  ...\n}\n')),(0,r.kt)("a",{name:"auth-to-local-properties"}),(0,r.kt)("h4",{id:"auth-to-local-properties"},"auth-to-local-properties"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"auth-to-local-properties")," block is valid in the stack-, service-, and component-level\ndescriptors. This block is a list of configuration specifications\n(",(0,r.kt)("inlineCode",{parentName:"p"},"config-type/property_name[|concatenation_scheme]"),") indicating which properties contain\nauth-to-local rules that should be dynamically updated based on the identities used within the\nKerberized cluster."),(0,r.kt)("p",null,"The specification optionally declares the concatenation scheme to use to append\nthe rules into a rule set value. If specified one of the following schemes may be set:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"new_lines"))," - rules in the rule set are separated by a new line (",(0,r.kt)("inlineCode",{parentName:"li"},"\\n"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"new_lines_escaped"))," - rules in the rule set are separated by a ",(0,r.kt)("inlineCode",{parentName:"li"},"\\")," and a new line (",(0,r.kt)("inlineCode",{parentName:"li"},"\\n"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"spaces"))," - rules in the rule set are separated by a whitespace character (effectively placing all rules in a single line)")),(0,r.kt)("p",null,"If not specified, the default concatenation scheme is ",(0,r.kt)("inlineCode",{parentName:"p"},"new_lines"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"auth-to-local-properties" : [\n  "core-site/hadoop.security.auth_to_local",\n  "service.properties/http.authentication.kerberos.name.rules|new_lines_escaped",\n  ...\n]\n')),(0,r.kt)("a",{name:"configurations"}),(0,r.kt)("h4",{id:"configurations"},"configurations"),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"configurations")," block may exist in stack-, service-, and component-level descriptors.\nThis block is a list of one or more configuration blocks containing a single structure named using\nthe configuration type and containing values for each relevant property."),(0,r.kt)("p",null,"Each property name and value may be a concrete value or contain variables to be replaced using values\nfrom the stack-level ",(0,r.kt)("inlineCode",{parentName:"p"},"properties")," block or any available configuration. Properties from the ",(0,r.kt)("inlineCode",{parentName:"p"},"properties"),"\nblock are referenced by name (",(0,r.kt)("inlineCode",{parentName:"p"},"${property_name}"),"), configuration properties are reference by\nconfiguration specification (",(0,r.kt)("inlineCode",{parentName:"p"},"${config-type/property_name}"),") and kerberos principals are referenced by the principal path\n(",(0,r.kt)("inlineCode",{parentName:"p"},"principals/SERVICE/COMPONENT/principal_name"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"configurations" : [\n  {\n    "config-type-1" : {\n      "${cluster-env/smokeuser}_property" : "value1",\n      "some_realm_property" : "${realm}",\n       ...\n    }\n  },\n  {\n    "config-type-2" : {\n      "property-2" : "${cluster-env/smokeuser}",\n      ...\n    }\n  },\n  ...\n]\n')),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},"cluster-env/smokuser")," was ",(0,r.kt)("inlineCode",{parentName:"p"},'"ambari-qa"')," and realm was ",(0,r.kt)("inlineCode",{parentName:"p"},'"EXAMPLE.COM"'),", the above block would\neffectively be translated to"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"configurations" : [\n  {\n    "config-type-1" : {\n      "ambari-qa_property" : "value1",\n      "some_realm_property" : "EXAMPLE.COM",\n      ...\n    }\n  },\n  {\n    "config-type-2" : {\n      "property-2" : "ambari-qa",\n      ...\n    }\n  },\n  ...\n]\n')),(0,r.kt)("a",{name:"identities"}),(0,r.kt)("h4",{id:"identities"},"identities"),(0,r.kt)("p",null,"An ",(0,r.kt)("inlineCode",{parentName:"p"},"identities")," descriptor may exist in stack-, service-, and component-level descriptors. This block\nis a list of zero or more identity descriptors. Each identity descriptor is a block containing a ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),",\nan optional ",(0,r.kt)("inlineCode",{parentName:"p"},"reference")," identifier, an optional ",(0,r.kt)("inlineCode",{parentName:"p"},"principal")," descriptor, and an optional ",(0,r.kt)("inlineCode",{parentName:"p"},"keytab"),"\ndescriptor."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," property of an ",(0,r.kt)("inlineCode",{parentName:"p"},"identity")," descriptor should be a concrete name that is unique with in its\n",(0,r.kt)("inlineCode",{parentName:"p"},"local")," scope (stack, service, or component). However, to maintain backwards-compatibility with\nprevious versions of Ambari, it may be a reference identifier to some other identity in the\nKerberos Descriptor. This feature is deprecated and may not be available in future versions of Ambari."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"reference")," property of an ",(0,r.kt)("inlineCode",{parentName:"p"},"identitiy")," descriptor is optional. If it exists, it indicates that the\nproperties from referenced identity is to be used as the base for the current identity and any properties\nspecified in the local identity block overrides the base data. In this scenario, the base data is copied\nto the local identities and therefore changes are realized locally, not globally. Referenced identities\nmay be hierarchical, so a referenced identity may reference another identity, and so on.  Because of\nthis, care must be taken not to create cyclic references. Reference values must be in the form of a\nrelative or absolute ",(0,r.kt)("em",{parentName:"p"},"path")," to the referenced identity descriptor. Relative ",(0,r.kt)("em",{parentName:"p"},"paths")," start with a ",(0,r.kt)("inlineCode",{parentName:"p"},"../"),"\nand may be specified in component-level identity descriptors to reference an identity descriptor\nin the parent service. Absolute ",(0,r.kt)("em",{parentName:"p"},"paths")," start with a ",(0,r.kt)("inlineCode",{parentName:"p"},"/")," and may be specified at any level as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Stack-level")," identity reference: ",(0,r.kt)("inlineCode",{parentName:"li"},"/identitiy_name")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Service-level")," identity reference: ",(0,r.kt)("inlineCode",{parentName:"li"},"/SERVICE_NAME/identitiy_name")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Component-level")," identity reference: ",(0,r.kt)("inlineCode",{parentName:"li"},"/SERVICE_NAME/COMPONENT_NAME/identitiy_name"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"identities" : [\n  {\n    "name" : "local_identity",\n    "principal" : {\n      ...\n    },\n    "keytab" : {\n      ...\n    }\n  },\n  {\n    "name" : "/smokeuser",\n    "principal" : {\n      "configuration" : "service-site/principal_property_name"\n    },\n    "keytab" : {\n      "configuration" : "service-site/keytab_property_name"\n    }\n  },\n  ...\n]\n')),(0,r.kt)("a",{name:"principal"}),(0,r.kt)("h4",{id:"principal"},"principal"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"principal")," block is an optional block inside an ",(0,r.kt)("inlineCode",{parentName:"p"},"identity")," descriptor block. It declares the\ndetails about the identity\u2019s principal, including the principal\u2019s ",(0,r.kt)("inlineCode",{parentName:"p"},"value"),", the ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," (user or service),\nthe relevant ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration")," property, and a local username mapping. All properties are optional; however\nif no base or default value is available (via the parent identity's ",(0,r.kt)("inlineCode",{parentName:"p"},"reference")," value) for all properties,\nthe principal may be ignored."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," property of the principal is expected to be the normalized principal name, including the\nprincipal\u2019s components and realm. In most cases, the realm should be specified using the realm variable\n(",(0,r.kt)("inlineCode",{parentName:"p"},"${realm}")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"${kerberos-env/realm}"),'). Also, in the case of a service principal, "',(0,r.kt)("inlineCode",{parentName:"p"},"_HOST"),'" should be\nused to represent the relevant hostname.  This value is typically replaced on the agent side by either\nthe agent-side scripts or the services themselves to be the hostname of the current host. However the\nbuilt-in hostname variable (',(0,r.kt)("inlineCode",{parentName:"p"},"${hostname}"),') may be used if "',(0,r.kt)("inlineCode",{parentName:"p"},"_HOST"),'" replacement on the agent-side is\nnot available for the service. Examples: ',(0,r.kt)("inlineCode",{parentName:"p"},"smokeuser@${realm}"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"service/_HOST@${realm}"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," property of the principal may be either ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"service"),". If not specified, the type is\nassumed to be ",(0,r.kt)("inlineCode",{parentName:"p"},"user"),". This value dictates how the identity is to be created in the KDC or Active Directory.\nIt is especially important in the Active Directory case due to how accounts are created. It also,\nindicates to Ambari how to handle the principal and relevant keytab file reguarding the user interface\nbehavior and data caching."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration")," property is an optional configuration specification (",(0,r.kt)("inlineCode",{parentName:"p"},"config-type/property_name"),")\nthat is to be set to this principal's ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," (after its variables have been replaced)."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"local_username")," property, if supplied, indicates which local user account to use when generating\nauth-to-local rules for this identity. If not specified, no explicit auth-to-local rule will be generated."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"principal" : {\n  "value": "${cluster-env/smokeuser}@${realm}",\n  "type" : "user" ,\n  "configuration": "cluster-env/smokeuser_principal_name",\n  "local_username" : "${cluster-env/smokeuser}"\n}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"principal" : {\n  "value": "component1/_HOST@${realm}",\n  "type" : "service" ,\n  "configuration": "service-site/component1.principal"\n}\n')),(0,r.kt)("a",{name:"keytab"}),(0,r.kt)("h4",{id:"keytab"},"keytab"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"keytab")," block is an optional block inside an ",(0,r.kt)("inlineCode",{parentName:"p"},"identity")," descriptor block. It describes how to\ncreate and store the relevant keytab file.  This block declares the keytab file's path in the local\nfilesystem of the destination host, the permissions to assign to that file, and the relevant\nconfiguration property."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"file")," property declares an absolute path to use to store the keytab file when distributing to\nrelevant hosts. If this is not supplied, the keytab file will not be created."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"owner")," property is an optional block indicating the local user account to assign as the owner of\nthe file and what access  (",(0,r.kt)("inlineCode",{parentName:"p"},'"rw"')," - read/write; ",(0,r.kt)("inlineCode",{parentName:"p"},'"r"')," - read-only) should\nbe granted to that user. By default, the owner will be given read-only access."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"group")," property is an optional block indicating which local group to assigned as the group owner\nof the file and what access (",(0,r.kt)("inlineCode",{parentName:"p"},'"rw"')," - read/write; ",(0,r.kt)("inlineCode",{parentName:"p"},'"r"')," - read-only; ",(0,r.kt)("inlineCode",{parentName:"p"},"\u201c\u201d")," - no access) should be granted\nto local user accounts in that group. By default, the group will be given no access."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"configuration")," property is an optional configuration specification (",(0,r.kt)("inlineCode",{parentName:"p"},"config-type/property_name"),")\nthat is to be set to the path of this keytabs file (after any variables have been replaced)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"keytab" : {\n  "file": "${keytab_dir}/smokeuser.headless.keytab",\n  "owner": {\n    "name": "${cluster-env/smokeuser}",\n    "access": "r"\n  },\n  "group": {\n    "name": "${cluster-env/user_group}",\n    "access": "r"\n  },\n  "configuration": "${cluster-env/smokeuser_keytab}"\n}\n')),(0,r.kt)("a",{name:"services"}),(0,r.kt)("h4",{id:"services-1"},"services"),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"services")," block may exist in the stack-level and the service-level Kerberos Descriptor file.\nThis block is a list of zero or more service descriptors to add to the Kerberos Descriptor."),(0,r.kt)("p",null,"Each service block contains a service ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),", and optionals ",(0,r.kt)("inlineCode",{parentName:"p"},"identities"),",  ",(0,r.kt)("inlineCode",{parentName:"p"},"auth_to_local_properties"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"configurations"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"components")," blocks."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"services": [\n  {\n    "name": "SERVICE1_NAME",\n    "identities": [\n      ...\n    ],\n    "auth_to_local_properties" : [\n      ...\n    ],\n    "configurations": [\n      ...\n    ],\n    "components": [\n      ...\n    ]\n  },\n  {\n    "name": "SERVICE2_NAME",\n    "identities": [\n      ...\n    ],\n    "auth_to_local_properties" : [\n      ...\n    ],\n    "configurations": [\n      ...\n    ],\n    "components": [\n      ...\n    ]\n  },\n  \u2026\n]\n')),(0,r.kt)("a",{name:"components"}),(0,r.kt)("h4",{id:"components-1"},"components"),(0,r.kt)("p",null,"A ",(0,r.kt)("inlineCode",{parentName:"p"},"components")," block may exist within a ",(0,r.kt)("inlineCode",{parentName:"p"},"service")," descriptor block. This block is a list of zero or\nmore component descriptors belonging to the containing service descriptor. Each component descriptor\nis a block containing a component ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),", and optional ",(0,r.kt)("inlineCode",{parentName:"p"},"identities"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"auth_to_local_properties"),",\nand ",(0,r.kt)("inlineCode",{parentName:"p"},"configurations")," blocks."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"components": [\n  {\n    "name": "COMPONENT_NAME",\n    "identities": [\n      ...\n    ],\n    "auth_to_local_properties" : [\n      ...\n    ],\n    "configurations": [\n      ...\n    ]\n  },\n  ...\n]\n')),(0,r.kt)("a",{name:"examples"}),(0,r.kt)("h3",{id:"examples-1"},"Examples"),(0,r.kt)("h4",{id:"example-stack-level-kerberos-descriptor"},"Example Stack-level Kerberos Descriptor"),(0,r.kt)("p",null,"The following example is annotated for descriptive purposes. The annotations are not valid in a real\nJSON-formatted file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  // Properties that can be used in variable replacement operations.\n  // For example, ${keytab_dir} will resolve to "/etc/security/keytabs".\n  // Since variable replacement is recursive, ${realm} will resolve\n  // to ${kerberos-env/realm}, which in-turn will resolve to the\n  // declared default realm for the cluster\n  "properties": {\n    "realm": "${kerberos-env/realm}",\n    "keytab_dir": "/etc/security/keytabs"\n  },\n  // A list of global Kerberos identities. These may be referenced\n  // using /identity_name. For example the \u201cspnego\u201d identity may be\n  // referenced using \u201c/spnego\u201d\n  "identities": [\n    {\n      "name": "spnego",\n      // Details about this identity\'s principal. This instance does not\n      // declare any value for configuration or local username. That is\n      // left up to the services and components use wish to reference\n      // this principal and set overrides for those values.\n      "principal": {\n        "value": "HTTP/_HOST@${realm}",\n        "type" : "service"\n      },\n      // Details about this identity\u2019s keytab file. This keytab file\n      // will be created in the configured keytab file directory with\n      // read-only access granted to root and users in the cluster\u2019s\n      // default user group (typically, hadoop). To ensure that only\n      // a single copy exists on the file system, references to this\n      // identity should not override the keytab file details;\n      // however if it is desired that multiple keytab files are\n      // created, these values may be overridden in a reference\n      // within a service or component. Since no configuration\n      // specification is set, the the keytab file location will not\n      // be set in any configuration file by default. Services and\n      // components need to reference this identity to update this\n      // value as needed.\n      "keytab": {\n        "file": "${keytab_dir}/spnego.service.keytab",\n        "owner": {\n          "name": "root",\n          "access": "r"\n        },\n        "group": {\n          "name": "${cluster-env/user_group}",\n          "access": "r"\n        }\n      }\n    },\n    {\n      "name": "smokeuser",\n      // Details about this identity\'s principal. This instance declares\n      // a configuration and local username mapping. Services and\n      // components can override this to set additional configurations\n      // that should be set to this principal value.  Overriding the\n      // local username may create undesired behavior since there may be\n      // conflicting entries in relevant auth-to-local rule sets.\n      "principal": {\n        "value": "${cluster-env/smokeuser}@${realm}",\n        "type" : "user",\n        "configuration": "cluster-env/smokeuser_principal_name",\n        "local_username" : "${cluster-env/smokeuser}"\n      },\n      // Details about this identity\u2019s keytab file. This keytab file\n      // will be created in the configured keytab file directory with\n      // read-only access granted to the configured smoke user\n      // (typically ambari-qa) and users in the cluster\u2019s default\n      // user group (typically hadoop). To ensure that only a single\n      // copy exists on the file system, references to this identity\n      // should not override the keytab file details; however if it\n      // is desired that multiple keytab files are created, these\n      // values may be overridden in a reference within a service or\n      // component.\n      "keytab": {\n        "file": "${keytab_dir}/smokeuser.headless.keytab",\n        "owner": {\n          "name": "${cluster-env/smokeuser}",\n          "access": "r"\n        },\n        "group": {\n          "name": "${cluster-env/user_group}",\n          "access": "r"\n        },\n        "configuration": "cluster-env/smokeuser_keytab"\n      }\n    }\n  ]\n}\n')),(0,r.kt)("h4",{id:"example-service-level-kerberos-descriptor"},"Example Service-level Kerberos Descriptor"),(0,r.kt)("p",null,"The following example is annotated for descriptive purposes. The annotations are not valid in a real\nJSON-formatted file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  // One or more services may be listed in a service-level Kerberos\n  // Descriptor file\n  "services": [\n    {\n      "name": "SERVICE_1",\n      // Service-level identities to be created if this service is installed.\n      // Any relevant keytab files will be distributed to hosts with at least\n      // one of the components on it.\n      "identities": [\n        // Service-specific identity declaration, declaring all properties\n        // needed initiate the creation of the principal and keytab files,\n        // as well as setting the service-specific  configurations.  This may\n        // be referenced by contained components using ../service1_identity.\n        {\n          "name": "service1_identity",\n          "principal": {\n            "value": "service1/_HOST@${realm}",\n            "type" : "service",\n            "configuration": "service1-site/service1.principal"\n          },\n          "keytab": {\n            "file": "${keytab_dir}/service1.service.keytab",\n            "owner": {\n              "name": "${service1-env/service_user}",\n              "access": "r"\n            },\n            "group": {\n              "name": "${cluster-env/user_group}",\n              "access": "r"\n            },\n            "configuration": "service1-site/service1.keytab.file"\n          }\n        },\n        // Service-level identity referencing the stack-level spnego\n        // identity and overriding the principal and keytab configuration\n        // specifications.\n        {\n          "name": "service1_spnego",\n          "reference": "/spnego",\n          "principal": {\n            "configuration": "service1-site/service1.web.principal"\n          },\n          "keytab": {\n            "configuration": "service1-site/service1.web.keytab.file"\n          }\n        },\n        // Service-level identity referencing the stack-level smokeuser\n        // identity. No properties are being overridden and overriding\n        // the principal and keytab configuration specifications.\n        // This ensures that the smokeuser principal is created and its\n        // keytab file is distributed to all hosts where components of this\n        // this service are installed.\n        {\n          "name": "service1_smokeuser",\n          "reference": "/smokeuser"\n        }\n      ],\n      // Properties related to this service that require the auth-to-local\n      // rules to be dynamically generated based on identities create for\n      // the cluster.\n      "auth_to_local_properties" : [\n        "service1-site/security.auth_to_local"\n      ],\n      // Configuration properties to be set when this service is installed,\n      // no matter which components are installed\n      "configurations": [\n        {\n          "service-site": {\n            "service1.security.authentication": "kerberos",\n            "service1.security.auth_to_local": ""\n          }\n        }\n      ],\n      // A list of components related to this service\n      "components": [\n        {\n          "name": "COMPONENT_1",\n          // Component-specific identities to be created when this component\n          // is installed.  Any keytab files specified will be distributed\n          // only to the hosts where this component is installed.\n          "identities": [\n            // An identity "local" to this component\n            {\n              "name": "component1_service_identity",\n              "principal": {\n                "value": "component1/_HOST@${realm}",\n                "type" : "service",\n                "configuration": "service1-site/comp1.principal",\n                "local_username" : "${service1-env/service_user}"\n              },\n              "keytab": {\n                "file": "${keytab_dir}/s1c1.service.keytab",\n                "owner": {\n                  "name": "${service1-env/service_user}",\n                  "access": "r"\n                },\n                "group": {\n                  "name": "${cluster-env/user_group}",\n                  "access": ""\n                },\n                "configuration": "service1-site/comp1.keytab.file"\n              }\n            },\n            // The stack-level spnego identity overridden to set component-specific\n            // configurations\n            {\n              "name": "component1_spnego_1",\n              "reference": "/spnego",\n              "principal": {\n                "configuration": "service1-site/comp1.spnego.principal"\n              },\n              "keytab": {\n                "configuration": "service1-site/comp1.spnego.keytab.file"\n              }\n            },\n            // The stack-level spnego identity overridden to set a different set of component-specific\n            // configurations\n            {\n              "name": "component1_spnego_2",\n              "reference": "/spnego",\n              "principal": {\n                "configuration": "service1-site/comp1.someother.principal"\n              },\n              "keytab": {\n                "configuration": "service1-site/comp1.someother.keytab.file"\n              }\n            }\n          ],\n          // Component-specific configurations to set if this component is installed\n          "configurations": [\n            {\n              "service-site": {\n                "comp1.security.type": "kerberos"\n              }\n            }\n          ]\n        },\n        {\n          "name": "COMPONENT_2",\n          "identities": [\n            {\n              "name": "component2_service_identity",\n              "principal": {\n                "value": "component2/_HOST@${realm}",\n                "type" : "service",\n                "configuration": "service1-site/comp2.principal",\n                "local_username" : "${service1-env/service_user}"\n              },\n              "keytab": {\n                "file": "${keytab_dir}/s1c2.service.keytab",\n                "owner": {\n                  "name": "${service1-env/service_user}",\n                  "access": "r"\n                },\n                "group": {\n                  "name": "${cluster-env/user_group}",\n                  "access": ""\n                },\n                "configuration": "service1-site/comp2.keytab.file"\n              }\n            },\n            // The service-level service1_identity identity overridden to\n            // set component-specific configurations\n            {\n              "name": "component2_service1_identity",\n              "reference": "../service1_identity",\n              "principal": {\n                "configuration": "service1-site/comp2.service.principal"\n              },\n              "keytab": {\n                "configuration": "service1-site/comp2.service.keytab.file"\n              }\n            }\n          ],\n          "configurations" : [\n            {\n              "service-site" : {\n                "comp2.security.type": "kerberos"\n              }\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n')))}d.isMDXComponent=!0}}]);