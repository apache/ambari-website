"use strict";(self.webpackChunkambari_website=self.webpackChunkambari_website||[]).push([[7877],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),d=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=d(e.components);return r.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=d(n),u=a,k=m["".concat(o,".").concat(u)]||m[u]||p[u]||i;return n?r.createElement(k,s(s({ref:t},c),{},{components:n})):r.createElement(k,s({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,s=new Array(i);s[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var d=2;d<i;d++)s[d]=n[d];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6821:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var r=n(7462),a=(n(7294),n(3905));const i={title:"Enabling Kerberos"},s=void 0,l={unversionedId:"ambari-design/kerberos/enabling_kerberos",id:"version-2.7.5/ambari-design/kerberos/enabling_kerberos",title:"Enabling Kerberos",description:"\x3c!---",source:"@site/versioned_docs/version-2.7.5/ambari-design/kerberos/enabling_kerberos.md",sourceDirName:"ambari-design/kerberos",slug:"/ambari-design/kerberos/enabling_kerberos",permalink:"/docs/2.7.5/ambari-design/kerberos/enabling_kerberos",draft:!1,editUrl:"https://github.com/vivostar/vivostar.github.io/tree/master/versioned_docs/version-2.7.5/ambari-design/kerberos/enabling_kerberos.md",tags:[],version:"2.7.5",frontMatter:{title:"Enabling Kerberos"},sidebar:"ambariSidebar",previous:{title:"The Kerberos Service",permalink:"/docs/2.7.5/ambari-design/kerberos/kerberos_service"},next:{title:"Blueprints",permalink:"/docs/2.7.5/blueprints"}},o={},d=[{value:"Enabling Kerberos",id:"enabling-kerberos",level:2},{value:"The Enable Kerberos Wizard",id:"the-enable-kerberos-wizard",level:3},{value:"The REST API",id:"the-rest-api",level:3},{value:"Add the KERBEROS Service to cluster",id:"add-the-kerberos-service-to-cluster",level:4},{value:"Add the KERBEROS_CLIENT component to the KERBEROS service",id:"add-the-kerberos_client-component-to-the-kerberos-service",level:4},{value:"Create and set KERBEROS service configurations",id:"create-and-set-kerberos-service-configurations",level:4},{value:"Create the KERBEROS_CLIENT host components",id:"create-the-kerberos_client-host-components",level:4},{value:"Install the KERBEROS service and components",id:"install-the-kerberos-service-and-components",level:4},{value:"Stop all services",id:"stop-all-services",level:4},{value:"Get the default Kerberos Descriptor",id:"get-the-default-kerberos-descriptor",level:4},{value:"Get the customized Kerberos Descriptor (if previously set)",id:"get-the-customized-kerberos-descriptor-if-previously-set",level:4},{value:"Set the Kerberos Descriptor",id:"set-the-kerberos-descriptor",level:4},{value:"Set the KDC administrator credentials",id:"set-the-kdc-administrator-credentials",level:4},{value:"Enable Kerberos",id:"enable-kerberos",level:4},{value:"Start all services",id:"start-all-services",level:4},{value:"Miscellaneous Technical Information",id:"miscellaneous-technical-information",level:3},{value:"Password Generation",id:"password-generation",level:4}],c={toc:d};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/2.7.5/kerberos"},"Introduction")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/2.7.5/ambari-design/kerberos/kerberos_descriptor"},"The Kerberos Descriptor")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/2.7.5/ambari-design/kerberos/kerberos_service"},"The Kerberos Service")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#enabling-kerberos"},"Enabling Kerberos"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#the-enable-kerberos-wizard"},"The Enable Kerberos Wizard")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#the-rest-api"},"The REST API")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#miscellaneous-technical-information"},"Miscellaneous Technical Information"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#password-generation"},"Password Generation"))))))),(0,a.kt)("a",{name:"enabling-kerberos"}),(0,a.kt)("h2",{id:"enabling-kerberos"},"Enabling Kerberos"),(0,a.kt)("p",null,"Enabling Kerberos on the cluster may be done using the ",(0,a.kt)("em",{parentName:"p"},"Enable Kerberos Wizard")," within the Ambari UI\nor using the REST API."),(0,a.kt)("a",{name:"the-enable-kerberos-wizard"}),(0,a.kt)("h3",{id:"the-enable-kerberos-wizard"},"The Enable Kerberos Wizard"),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"Enable Kerberos Wizard"),", in the Ambari UI, provides an easy to use wizard interface that walks\nthrough the process of enabling Kerberos."),(0,a.kt)("a",{name:"the-rest-api"}),(0,a.kt)("h3",{id:"the-rest-api"},"The REST API"),(0,a.kt)("p",null,"It is possible to enable Kerberos using Ambari's REST API using the following API calls:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Notes:"))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Change the authentication credentials as needed",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"curl ... -u username:password ...")),(0,a.kt)("li",{parentName:"ul"},"The examples below use",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"username: admin"),(0,a.kt)("li",{parentName:"ul"},"password: admin"))))),(0,a.kt)("li",{parentName:"ul"},"Change the Ambari server host name and port as needed",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"curl ... http://HOST:PORT/api/v1/...")),(0,a.kt)("li",{parentName:"ul"},"The examples below use",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"HOST:  AMBARI_SERVER"),(0,a.kt)("li",{parentName:"ul"},"PORT: 8080"))))),(0,a.kt)("li",{parentName:"ul"},"Change the cluster name as needed",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"curl ... http://.../CLUSTER/...")),(0,a.kt)("li",{parentName:"ul"},"The examples below use",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"CLUSTER:  CLUSTER_NAME"))))),(0,a.kt)("li",{parentName:"ul"},"@./payload indicates the the payload data is stored in some file rather than declared inline",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"curl ... -d @./payload ...")),(0,a.kt)("li",{parentName:"ul"},"The examples below use ",(0,a.kt)("inlineCode",{parentName:"li"},"./payload")," which should be replace with the actual file path"),(0,a.kt)("li",{parentName:"ul"},"The contents of the payload file are indicated below the curl statement")))),(0,a.kt)("h4",{id:"add-the-kerberos-service-to-cluster"},"Add the KERBEROS Service to cluster"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X POST http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/services/KERBEROS\n')),(0,a.kt)("h4",{id:"add-the-kerberos_client-component-to-the-kerberos-service"},"Add the KERBEROS_CLIENT component to the KERBEROS service"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X POST http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/services/KERBEROS/components/KERBEROS_CLIENT\n')),(0,a.kt)("h4",{id:"create-and-set-kerberos-service-configurations"},"Create and set KERBEROS service configurations"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X PUT -d @./payload http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME\n')),(0,a.kt)("p",null,"Example payload when using an MIT KDC:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'[\n  {\n    "Clusters": {\n      "desired_config": {\n        "type": "krb5-conf",\n        "tag": "version1",\n        "properties": {\n          "domains":"",\n          "manage_krb5_conf": "true",\n          "conf_dir":"/etc",\n          "content" : "[libdefaults]\\n  renew_lifetime = 7d\\n  forwardable = true\\n  default_realm = {{realm}}\\n  ticket_lifetime = 24h\\n  dns_lookup_realm = false\\n  dns_lookup_kdc = false\\n  default_ccache_name = /tmp/krb5cc_%{uid}\\n  #default_tgs_enctypes = {{encryption_types}}\\n  #default_tkt_enctypes = {{encryption_types}}\\n{% if domains %}\\n[domain_realm]\\n{%- for domain in domains.split(\',\') %}\\n  {{domain|trim()}} = {{realm}}\\n{%- endfor %}\\n{% endif %}\\n[logging]\\n  default = FILE:/var/log/krb5kdc.log\\n  admin_server = FILE:/var/log/kadmind.log\\n  kdc = FILE:/var/log/krb5kdc.log\\n\\n[realms]\\n  {{realm}} = {\\n{%- if master_kdc %}\\n    master_kdc = {{master_kdc|trim()}}\\n{%- endif -%}\\n{%- if kdc_hosts > 0 -%}\\n{%- set kdc_host_list = kdc_hosts.split(\',\')  -%}\\n{%- if kdc_host_list and kdc_host_list|length > 0 %}\\n    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}\\n{%- if kdc_host_list -%}\\n{%- if master_kdc and (master_kdc not in kdc_host_list) %}\\n    kdc = {{master_kdc|trim()}}\\n{%- endif -%}\\n{% for kdc_host in kdc_host_list %}\\n    kdc = {{kdc_host|trim()}}\\n{%- endfor -%}\\n{% endif %}\\n{%- endif %}\\n{%- endif %}\\n  }\\n\\n{# Append additional realm declarations below #}"\n        }\n      }\n    }\n  },\n  {\n    "Clusters": {\n      "desired_config": {\n        "type": "kerberos-env",\n        "tag": "version1",\n        "properties": {\n          "kdc_type": "mit-kdc",\n          "manage_identities": "true",\n          "create_ambari_principal": "true",\n          "manage_auth_to_local": "true",\n          "install_packages": "true",\n          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",\n          "realm" : "EXAMPLE.COM",\n          "kdc_hosts" : "FQDN.KDC.SERVER",\n          "master_kdc" : "FQDN.MASTER.KDC.SERVER",\n          "admin_server_host" : "FQDN.ADMIN.KDC.SERVER",\n          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",\n          "service_check_principal_name" : "${cluster_name}-${short_date}",\n          "case_insensitive_username_rules" : "false"\n        }\n      }\n    }\n  }\n]\n')),(0,a.kt)("p",null,"Example payload when using an Active Directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'[\n  {\n    "Clusters": {\n      "desired_config": {\n        "type": "krb5-conf",\n        "tag": "version1",\n        "properties": {\n          "domains":"",\n          "manage_krb5_conf": "true",\n          "conf_dir":"/etc",\n          "content" : "[libdefaults]\\n  renew_lifetime = 7d\\n  forwardable = true\\n  default_realm = {{realm}}\\n  ticket_lifetime = 24h\\n  dns_lookup_realm = false\\n  dns_lookup_kdc = false\\n  default_ccache_name = /tmp/krb5cc_%{uid}\\n  #default_tgs_enctypes = {{encryption_types}}\\n  #default_tkt_enctypes = {{encryption_types}}\\n{% if domains %}\\n[domain_realm]\\n{%- for domain in domains.split(\',\') %}\\n  {{domain|trim()}} = {{realm}}\\n{%- endfor %}\\n{% endif %}\\n[logging]\\n  default = FILE:/var/log/krb5kdc.log\\n  admin_server = FILE:/var/log/kadmind.log\\n  kdc = FILE:/var/log/krb5kdc.log\\n\\n[realms]\\n  {{realm}} = {\\n{%- if master_kdc %}\\n    master_kdc = {{master_kdc|trim()}}\\n{%- endif -%}\\n{%- if kdc_hosts > 0 -%}\\n{%- set kdc_host_list = kdc_hosts.split(\',\')  -%}\\n{%- if kdc_host_list and kdc_host_list|length > 0 %}\\n    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}\\n{%- if kdc_host_list -%}\\n{%- if master_kdc and (master_kdc not in kdc_host_list) %}\\n    kdc = {{master_kdc|trim()}}\\n{%- endif -%}\\n{% for kdc_host in kdc_host_list %}\\n    kdc = {{kdc_host|trim()}}\\n{%- endfor -%}\\n{% endif %}\\n{%- endif %}\\n{%- endif %}\\n  }\\n\\n{# Append additional realm declarations below #}"\n        }\n      }\n    }\n  },\n  {\n    "Clusters": {\n      "desired_config": {\n        "type": "kerberos-env",\n        "tag": "version1",\n        "properties": {\n          "kdc_type": "active-directory",\n          "manage_identities": "true",\n          "create_ambari_principal": "true",\n          "manage_auth_to_local": "true",\n          "install_packages": "true",\n          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",\n          "realm" : "EXAMPLE.COM",\n          "kdc_hosts" : "FQDN.AD.SERVER",\n          "master_kdc" : "FQDN.MASTER.AD.SERVER",\n          "admin_server_host" : "FQDN.AD.SERVER",\n          "ldap_url" : "LDAPS://AD_HOST:PORT",\n          "container_dn" : "OU=....,....",\n          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",\n          "password_length": "20",\n          "password_min_lowercase_letters": "1",\n          "password_min_uppercase_letters": "1",\n          "password_min_digits": "1",\n          "password_min_punctuation": "1",\n          "password_min_whitespace": "0",\n          "service_check_principal_name" : "${cluster_name}-${short_date}",\n          "case_insensitive_username_rules" : "false",\n          "create_attributes_template" :  "{\\n \\"objectClass\\": [\\"top\\", \\"person\\", \\"organizationalPerson\\", \\"user\\"],\\n \\"cn\\": \\"$principal_name\\",\\n #if( $is_service )\\n \\"servicePrincipalName\\": \\"$principal_name\\",\\n #end\\n \\"userPrincipalName\\": \\"$normalized_principal\\",\\n \\"unicodePwd\\": \\"$password\\",\\n \\"accountExpires\\": \\"0\\",\\n \\"userAccountControl\\": \\"66048\\"}"\n        }\n      }\n    }\n  }\n]\n')),(0,a.kt)("p",null,"Example payload when using IPA:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'[\n  {\n    "Clusters": {\n      "desired_config": {\n        "type": "krb5-conf",\n        "tag": "version1",\n        "properties": {\n          "domains":"",\n          "manage_krb5_conf": "true",\n          "conf_dir":"/etc",\n          "content" : "[libdefaults]\\n  renew_lifetime = 7d\\n  forwardable = true\\n  default_realm = {{realm}}\\n  ticket_lifetime = 24h\\n  dns_lookup_realm = false\\n  dns_lookup_kdc = false\\n  default_ccache_name = /tmp/krb5cc_%{uid}\\n  #default_tgs_enctypes = {{encryption_types}}\\n  #default_tkt_enctypes = {{encryption_types}}\\n{% if domains %}\\n[domain_realm]\\n{%- for domain in domains.split(\',\') %}\\n  {{domain|trim()}} = {{realm}}\\n{%- endfor %}\\n{% endif %}\\n[logging]\\n  default = FILE:/var/log/krb5kdc.log\\n  admin_server = FILE:/var/log/kadmind.log\\n  kdc = FILE:/var/log/krb5kdc.log\\n\\n[realms]\\n  {{realm}} = {\\n{%- if master_kdc %}\\n    master_kdc = {{master_kdc|trim()}}\\n{%- endif -%}\\n{%- if kdc_hosts > 0 -%}\\n{%- set kdc_host_list = kdc_hosts.split(\',\')  -%}\\n{%- if kdc_host_list and kdc_host_list|length > 0 %}\\n    admin_server = {{admin_server_host|default(kdc_host_list[0]|trim(), True)}}\\n{%- if kdc_host_list -%}\\n{%- if master_kdc and (master_kdc not in kdc_host_list) %}\\n    kdc = {{master_kdc|trim()}}\\n{%- endif -%}\\n{% for kdc_host in kdc_host_list %}\\n    kdc = {{kdc_host|trim()}}\\n{%- endfor -%}\\n{% endif %}\\n{%- endif %}\\n{%- endif %}\\n  }\\n\\n{# Append additional realm declarations below #}"\n        }\n      }\n    }\n  },\n  {\n    "Clusters": {\n      "desired_config": {\n        "type": "kerberos-env",\n        "tag": "version1",\n        "properties": {\n          "kdc_type": "ipa",\n          "manage_identities": "true",\n          "create_ambari_principal": "true",\n          "manage_auth_to_local": "true",\n          "install_packages": "true",\n          "encryption_types": "aes des3-cbc-sha1 rc4 des-cbc-md5",\n          "realm" : "EXAMPLE.COM",\n          "kdc_hosts" : "FQDN.KDC.SERVER",\n          "master_kdc" : "FQDN.MASTER.KDC.SERVER",\n          "admin_server_host" : "FQDN.ADMIN.KDC.SERVER",\n          "executable_search_paths" : "/usr/bin, /usr/kerberos/bin, /usr/sbin, /usr/lib/mit/bin, /usr/lib/mit/sbin",\n          "service_check_principal_name" : "${cluster_name}-${short_date}",\n          "case_insensitive_username_rules" : "false"\n        }\n      }\n    }\n  }\n]\n')),(0,a.kt)("h4",{id:"create-the-kerberos_client-host-components"},"Create the KERBEROS_CLIENT host components"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Once for each host, replace HOST_NAME")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X POST -d \'{"host_components" : [{"HostRoles" : {"component_name":"KERBEROS_CLIENT"}}]}\' http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/hosts?Hosts/host_name=HOST_NAME\n')),(0,a.kt)("h4",{id:"install-the-kerberos-service-and-components"},"Install the KERBEROS service and components"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X PUT -d \'{"ServiceInfo": {"state" : "INSTALLED"}}\' http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/services/KERBEROS\n')),(0,a.kt)("h4",{id:"stop-all-services"},"Stop all services"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X PUT -d  \'{"RequestInfo":{"context":"Stop Service"},"Body":{"ServiceInfo":{"state":"INSTALLED"}}}\' http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/services\n')),(0,a.kt)("h4",{id:"get-the-default-kerberos-descriptor"},"Get the default Kerberos Descriptor"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X GET http://AMBARI_SERVER:8080/api/v1/stacks/STACK_NAME/versions/STACK_VERSION/artifacts/kerberos_descriptor\n')),(0,a.kt)("h4",{id:"get-the-customized-kerberos-descriptor-if-previously-set"},"Get the customized Kerberos Descriptor (if previously set)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X GET http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/artifacts/kerberos_descriptor\n')),(0,a.kt)("h4",{id:"set-the-kerberos-descriptor"},"Set the Kerberos Descriptor"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X POST -d @./payload http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/artifacts/kerberos_descriptor\n')),(0,a.kt)("p",null,"Payload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n  "artifact_data" : {\n    ... \n  } \n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Note:"))," The Kerberos Descriptor payload may be a complete Kerberos Descriptor or just the updates to overlay on top of the default Kerberos Descriptor."),(0,a.kt)("h4",{id:"set-the-kdc-administrator-credentials"},"Set the KDC administrator credentials"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X POST -d @./payload http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/credentials/kdc.admin.credential\n')),(0,a.kt)("p",null,"Payload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n  "Credential" : {\n    "principal" : "admin/admin@EXAMPLE.COM",\n    "key" : "h4d00p&!",\n    "type" : "temporary"\n  }\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Note:"))," the ",(0,a.kt)("em",{parentName:"p"},"principal")," and ",(0,a.kt)("em",{parentName:"p"},"key")," (password) values should be updated to match the correct credentials\nfor the KDC administrator account"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Note:"))," the ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," value may be ",(0,a.kt)("inlineCode",{parentName:"p"},"temporary")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"persisted"),"; however the value may only be ",(0,a.kt)("inlineCode",{parentName:"p"},"persisted"),"\nif Ambari's credential store has been previously setup."),(0,a.kt)("h4",{id:"enable-kerberos"},"Enable Kerberos"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X PUT -d @./payload http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME\n')),(0,a.kt)("p",null,"Payload"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n  "Clusters": {\n    "security_type" : "KERBEROS"\n  }\n}\n')),(0,a.kt)("h4",{id:"start-all-services"},"Start all services"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'curl -H "X-Requested-By:ambari" -u admin:admin -i -X PUT -d \'{"ServiceInfo": {"state" : "STARTED"}}\' http://AMBARI_SERVER:8080/api/v1/clusters/CLUSTER_NAME/services\n')),(0,a.kt)("a",{name:"miscellaneous-technical-information"}),(0,a.kt)("h3",{id:"miscellaneous-technical-information"},"Miscellaneous Technical Information"),(0,a.kt)("a",{name:"password-generation"}),(0,a.kt)("h4",{id:"password-generation"},"Password Generation"),(0,a.kt)("p",null,"When enabling Kerberos using an Active Directory, Ambari must use an internal mechanism to build\nthe keytab files. This is because keytab files cannot be requested remotely from an Active Directory.\nIn order to create keytab files, Ambari needs to know the password for each relevant Kerberos\nidentity.  Therefore, Ambari sets or updates the identity's password as needed."),(0,a.kt)("p",null,"The password for each Ambari-managed account in an Active Directory is randomly generated and\nstored only long enough in memory to set the account's password and generate the keytab file.",(0,a.kt)("br",{parentName:"p"}),"\n","Passwords are generated using the following user-settable parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Password length (",(0,a.kt)("inlineCode",{parentName:"li"},"kerberos-env/password_length"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Default Value: 20"))),(0,a.kt)("li",{parentName:"ul"},"Minimum number of lower-cased letters (",(0,a.kt)("inlineCode",{parentName:"li"},"kerberos-env/password_min_lowercase_letters"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Default Value:  1"),(0,a.kt)("li",{parentName:"ul"},"Character Set: ",(0,a.kt)("inlineCode",{parentName:"li"},"abcdefghijklmnopqrstuvwxyz")))),(0,a.kt)("li",{parentName:"ul"},"Minimum number of upper-cased letters (",(0,a.kt)("inlineCode",{parentName:"li"},"kerberos-env/password_min_uppercase_letters"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Default Value: 1"),(0,a.kt)("li",{parentName:"ul"},"Character Set: ",(0,a.kt)("inlineCode",{parentName:"li"},"ABCDEFGHIJKLMNOPQRSTUVWXYZ")))),(0,a.kt)("li",{parentName:"ul"},"Minimum number of digits (",(0,a.kt)("inlineCode",{parentName:"li"},"kerberos-env/password_min_digits"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Default Value: 1"),(0,a.kt)("li",{parentName:"ul"},"Character Set: ",(0,a.kt)("inlineCode",{parentName:"li"},"1234567890")))),(0,a.kt)("li",{parentName:"ul"},"Minimum number of punctuation characters (",(0,a.kt)("inlineCode",{parentName:"li"},"kerberos-env/password_min_punctuation"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Default Value: 1"),(0,a.kt)("li",{parentName:"ul"},"Character Set: ",(0,a.kt)("inlineCode",{parentName:"li"},"?.!$%^*()-_+=~")))),(0,a.kt)("li",{parentName:"ul"},"Minimum number of whitespace characters (",(0,a.kt)("inlineCode",{parentName:"li"},"kerberos-env/password_min_whitespace"),")",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Default Value: 0"),(0,a.kt)("li",{parentName:"ul"},"Character Set: ",(0,a.kt)("inlineCode",{parentName:"li"},"(space character)"))))),(0,a.kt)("p",null,"The following algorithm is executed:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Create an array to store password characters"),(0,a.kt)("li",{parentName:"ol"},"For each character class (upper-case letter, lower-case letter, digit, ...), randomly select the\nminimum number of characters from the relevant character set and store them in the array"),(0,a.kt)("li",{parentName:"ol"},"For the number of characters calculated as the difference between the expected password length and\nthe number of characters already collected, randomly select a character from a randomly-selected character\nclass and store it into the array"),(0,a.kt)("li",{parentName:"ol"},"For the number of characters expected in the password, randomly pull one from the array and append\nto the password result"),(0,a.kt)("li",{parentName:"ol"},"Return the generated password")),(0,a.kt)("p",null,"To generate a random integer used to identify an index within a character set, a static instance of\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"java.security.SecureRandom")," class (",(0,a.kt)("a",{parentName:"p",href:"http://docs.oracle.com/javase/7/docs/api/java/security/SecureRandom.html"},"http://docs.oracle.com/javase/7/docs/api/java/security/SecureRandom.html"),")\nis used."))}p.isMDXComponent=!0}}]);